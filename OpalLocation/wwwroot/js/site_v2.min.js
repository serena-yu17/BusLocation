(function(){function w(n){return String(n).replace(/[&<>"'`=\/]/g,function(n){return it[n]})}function b(){tt(!0)}function k(){f||(f=setInterval(function(){document.getElementById("map").classList.contains("hidden")||tt()},15e3));l&&clearTimeout(l);l=setTimeout(function(){f&&(clearInterval(f),f=null)},6e5)}function h(){for(var t=i.getZoom(),n=0;n<a.length;n++)if(t>=a[n][0])return a[n][1];return 1}function ft(t){if(n)for(var i=0;i<n.length;i++)n[i].setIcon(d(t));if(r)for(i=0;i<r.length;i++)r[i].setIcon(nt(t));o&&o.setIcon(g(t))}function d(n){var t=Math.max($(document).width(),$(document).height())*.015;return n!==undefined&&(t*=n),{url:"/images/Bus.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/2,t/2),labelOrigin:new google.maps.Point(t/2,-t/8)}}function g(n){var t=Math.max($(document).width(),$(document).height())*.015;return n!==undefined&&(t*=n),{url:"/images/crosshair.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/2,t/2),labelOrigin:new google.maps.Point(t*.75,-t/6)}}function nt(n){var t=Math.max($(document).width(),$(document).height())*.006;return n!==undefined&&(t*=n),{url:"/images/dot-orange.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/3,t/3)}}function et(){var t=document.getElementById("route"),n=t.value.trim();n!==""&&(document.getElementById("map").classList.add("hidden"),document.getElementById("btn-traffic").classList.add("hidden"),$.ajax({type:"GET",url:tripUrl,data:{route:n},success:function(n){ht(n)},error:function(n){console.log(n)},complete:function(){document.getElementById("loading").classList.add("hidden")}}))}function tt(n){var i=null,f,h,e,o,s,r,c;for(f in u)if(u.hasOwnProperty(f)&&(h=u[f].radID,e=document.getElementById(h),e&&e.checked)){i=u[f].trips;break}if(i!==null&&i.length!==0){for(o=[],s=[],r=0;r<i.length;r++)o.push(i[r].toString()),!t.hasOwnProperty(i[r])&&n&&s.push(i[r]);n&&ot(s,i);c={tripIDs:o.join(",")};$.ajax({type:"GET",url:locUrl,data:c,cache:!1,success:function(t){ct(t,n)},error:function(n){console.log(n)}})}}function ot(n,i){for(var u=[],r=0;r<n.length;r++)u.push(n[r].toString());$.ajax({type:"GET",url:stopUrl,data:{tripIDs:u.join(",")},success:function(n){var u,f,o;if(n&&n.length!==0){for(u in n)if(n.hasOwnProperty(u))for(f=n[u],t.hasOwnProperty(u)||(t[u]=[]),e.hasOwnProperty(u)||(e[u]=new Set),r=0;r<f.length;r++)o=f[r].latitude.toString()+"&"+f[r].longitude.toString(),e[u].has(o)||(t[u].push(f[r]),e[u].add(o));st(i)}},error:function(n){console.log(n)}})}function st(n){for(var o,e,f,s,c,u=0;u<r.length;u++)r[u].setMap(null);if(r.length=0,n&&n.length!==0)for(o=new Set,u=0;u<n.length;u++)if(t.hasOwnProperty(n[u])&&t[n[u]])for(e=t[n[u]],f=0;f<e.length;f++)s=e[f].latitude.toString()+"&"+e[f].longitude.toString(),o.has(s)||(c=new google.maps.Marker({position:new google.maps.LatLng(e[f].latitude,e[f].longitude),icon:nt(h()),map:i}),r.push(c),o.add(s))}function ht(n){var e,t,i,r,f,o,s;if(n){e=!0;for(t in n)if(n.hasOwnProperty(t)){e=!1;break}if(e){document.getElementById("directionForm").classList.add("hidden");document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";return}document.getElementById("directionForm").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");i=0;for(t in n)n.hasOwnProperty(t)&&(r=document.createElement("label"),r.classList.add("form-control"),f="directionRadio"+i.toString(),o='<input type="radio" class="directionRadio" name="direction" id="'+f+'"/> '+w(t),i===0&&(o='<input type="radio" class="directionRadio" name="direction" id="'+f+'" checked/> '+w(t)),r.innerHTML=o,s="directionOption"+i.toString(),r.id=s,document.getElementById("directionOptions").appendChild(r),u[s]={radID:f,trips:n[t]},i++);document.getElementById("directionRadio0")&&document.getElementById("directionRadio0").focus();b()}}function ct(t,r){var l,k,f,tt,c,it;if(t){l=!0;for(k in t)if(t.hasOwnProperty(k)){l=!1;break}if(l){document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";document.getElementById("map").classList.add("hidden");document.getElementById("btn-traffic").classList.add("hidden");return}document.getElementById("map").classList.remove("hidden");document.getElementById("btn-traffic").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");var nt=[],u=0,a=-1e4,v=1e4,y=-1e4,w=1e4;for(f in t)if(t.hasOwnProperty(f)){var e=t[f].coordinate.latitude,s=t[f].coordinate.longitude,b=t[f].occupancy;b||(b=" ");r===!0&&(e>a&&(a=e),e<v&&(v=e),s>y&&(y=s),s<w&&(w=s));tt=new google.maps.Marker({position:new google.maps.LatLng(e,s),icon:d(h()),label:{text:b,color:"#BE1616",fontSize:"16px",fontWeight:"bold"},zIndex:p,map:i});u<n.length&&n[u].setMap(null);u++;p++;nt.push(tt)}if(u<n.length)for(c=u;c<n.length;c++)n[c].setMap(null);n=nt;r===!0&&(it=new google.maps.LatLngBounds(new google.maps.LatLng(v,w),new google.maps.LatLng(a,y)),i.fitBounds(it,Math.max($(document).width(),$(document).height())*.02));navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){userLoc=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);o&&o.setMap(null);o=new google.maps.Marker({position:userLoc,icon:g(h()),label:{text:"I am here",color:"#2916BE",fontSize:"16px",fontWeight:"bold"},zindex:ut,map:i})})}}var it={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},u={},n=[],f=null,l=null,t={},e={},rt=new Set,r=[],o=null,s=null,y="",a=[[16,1.8],[15,1.5],[14,1.2]],p=1e4,ut=99999,i=new google.maps.Map(document.getElementById("map"),{zoom:13,panControl:!0,zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,overviewMapControl:!0,rotateControl:!0}),v,c;$("#main-form").submit(function(n){var t=document.getElementById("route").value.trim();if(t===""||t===y)n.preventDefault();else return!0});google.maps.event.addListener(i,"zoom_changed",function(){ft(h())});$("#directionOptions").on("change",".directionRadio",function(){b()});$(document.body).bind("mousemove keydown click",k);document.getElementById("route").onfocus=function(){document.getElementById("directionForm").classList.add("fade");document.getElementById("map").classList.add("fade");document.getElementById("btn-traffic").classList.add("fade")};document.getElementById("route").onblur=function(){document.getElementById("directionForm").classList.remove("fade");document.getElementById("map").classList.remove("fade");document.getElementById("btn-traffic").classList.remove("fade")};document.getElementById("btn-traffic").onclick=function(){s===null?(s=new google.maps.TrafficLayer,s.setMap(i),this.classList.remove("btn-outline-success"),this.classList.add("btn-success")):(s.setMap(null),s=null,this.classList.add("btn-outline-success"),this.classList.remove("btn-success"))};v=new URLSearchParams(window.location.search);v.has("route")&&(c=v.get("route"),document.getElementById("route").value=c,y=c,document.title="Bus Location: "+c,document.getElementById("loading").classList.remove("hidden"),et(),k(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){initialLocation=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);i.setCenter(initialLocation)}),setInterval(function(){t={};e={};rt.clear()},864e5))})();