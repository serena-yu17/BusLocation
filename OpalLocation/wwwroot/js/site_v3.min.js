(function(){function b(n){return String(n).replace(/[&<>"'`=\/]/g,function(n){return et[n]})}function k(){it(!0)}function d(){e||(e=setInterval(function(){document.getElementById("map").classList.contains("hidden")||it()},15e3));a&&clearTimeout(a);a=setTimeout(function(){e&&(clearInterval(e),e=null)},6e5)}function c(){for(var t=r.getZoom(),n=0;n<v.length;n++)if(t>=v[n][0])return v[n][1];return 1}function ht(t){if(n)for(var i=0;i<n.length;i++)n[i].setIcon(g(t));if(u)for(i=0;i<u.length;i++)u[i].setIcon(tt(t));s&&s.setIcon(nt(t))}function g(n){var t=Math.max($(document).width(),$(document).height())*.015;return n!==undefined&&(t*=n),{url:"/images/Bus.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/2,t/2),labelOrigin:new google.maps.Point(t/2,-t/8)}}function nt(n){var t=Math.max($(document).width(),$(document).height())*.015;return n!==undefined&&(t*=n),{url:"/images/crosshair.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/2,t/2),labelOrigin:new google.maps.Point(t*.75,-t/6)}}function tt(n){var t=Math.max($(document).width(),$(document).height())*.006;return n!==undefined&&(t*=n),{url:"/images/dot-orange.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/3,t/3)}}function ct(){var r=document.getElementById("route"),n=r.value.trim(),t,i;if(n!==""){if(document.getElementById("map").classList.add("hidden"),document.getElementById("btn-traffic").classList.add("hidden"),window.sessionStorage&&(t=window.sessionStorage.getItem(n),t)){i=JSON.parse(t);ut(i);document.getElementById("loading").classList.add("hidden");return}$.ajax({type:"GET",url:tripUrl,data:{route:n},success:function(t){ut(t);window.localStorage&&window.localStorage.setItem(n,JSON.stringify(t))},error:function(n){console.log(n)},complete:function(){document.getElementById("loading").classList.add("hidden")}})}}function it(n){var i=null,u,a,e,o,s,r,h,c,l,v;for(u in f)if(f.hasOwnProperty(u)&&(a=f[u].radID,e=document.getElementById(a),e&&e.checked)){i=f[u].trips;break}if(i!==null&&i.length!==0){for(o=[],s=[],r=0;r<i.length;r++)o.push(i[r].toString()),!t.hasOwnProperty(i[r])&&n&&s.push(i[r]);if(n&&lt(s,i),h={tripIDs:o.join(",")},c=JSON.stringify(h),window.sessionStorage&&(l=window.sessionStorage.getItem(c),l)){v=JSON.parse(l);ft(v,n);return}$.ajax({type:"GET",url:locUrl,data:h,cache:!1,success:function(t){window.sessionStorage&&window.sessionStorage.setItem(c,JSON.stringify(t));ft(t,n)},error:function(n){console.log(n)}})}}function lt(n,t){for(var e,u,f,o,i=[],r=0;r<n.length;r++)i.push(n[r].toString());if(e={tripIDs:i.join(",")},u=JSON.stringify(e),window.sessionStorage&&(f=window.sessionStorage.getItem(u),f)){o=JSON.parse(f);rt(o,t);return}$.ajax({type:"GET",url:stopUrl,data:{tripIDs:i.join(",")},success:function(n){window.sessionStorage&&window.sessionStorage.setItem(u,JSON.stringify(n));rt(n,t)},error:function(n){console.log(n)}})}function rt(n,r){var u,f,e;if(n&&n.length!==0){for(u in n)if(n.hasOwnProperty(u))for(f=n[u],t.hasOwnProperty(u)||(t[u]=[]),o.hasOwnProperty(u)||(o[u]=new Set),i=0;i<f.length;i++)e=f[i].latitude.toString()+"&"+f[i].longitude.toString(),o[u].has(e)||(t[u].push(f[i]),o[u].add(e));at(r)}}function at(n){for(var o,e,f,s,h,i=0;i<u.length;i++)u[i].setMap(null);if(u.length=0,n&&n.length!==0)for(o=new Set,i=0;i<n.length;i++)if(t.hasOwnProperty(n[i])&&t[n[i]])for(e=t[n[i]],f=0;f<e.length;f++)s=e[f].latitude.toString()+"&"+e[f].longitude.toString(),o.has(s)||(h=new google.maps.Marker({position:new google.maps.LatLng(e[f].latitude,e[f].longitude),icon:tt(c()),map:r}),u.push(h),o.add(s))}function ut(n){var e,t,i,r,u,o,s;if(n){e=!0;for(t in n)if(n.hasOwnProperty(t)){e=!1;break}if(e){document.getElementById("directionForm").classList.add("hidden");document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";return}document.getElementById("directionForm").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");i=0;for(t in n)n.hasOwnProperty(t)&&(r=document.createElement("label"),r.classList.add("form-control"),u="directionRadio"+i.toString(),o='<input type="radio" class="directionRadio" name="direction" id="'+u+'"/> '+b(t),i===0&&(o='<input type="radio" class="directionRadio" name="direction" id="'+u+'" checked/> '+b(t)),r.innerHTML=o,s="directionOption"+i.toString(),r.id=s,document.getElementById("directionOptions").appendChild(r),f[s]={radID:u,trips:n[t]},i++);document.getElementById("directionRadio0")&&document.getElementById("directionRadio0").focus();k()}}function ft(t,i){var l,k,f,tt,h,it;if(t){l=!0;for(k in t)if(t.hasOwnProperty(k)){l=!1;break}if(l){document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";document.getElementById("map").classList.add("hidden");document.getElementById("btn-traffic").classList.add("hidden");return}document.getElementById("map").classList.remove("hidden");document.getElementById("btn-traffic").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");var d=[],u=0,a=-1e4,v=1e4,y=-1e4,p=1e4;for(f in t)if(t.hasOwnProperty(f)){var e=t[f].coordinate.latitude,o=t[f].coordinate.longitude,b=t[f].occupancy;b||(b=" ");i===!0&&(e>a&&(a=e),e<v&&(v=e),o>y&&(y=o),o<p&&(p=o));tt=new google.maps.Marker({position:new google.maps.LatLng(e,o),icon:g(c()),label:{text:b,color:"#BE1616",fontSize:"16px",fontWeight:"bold"},zIndex:w,map:r});u<n.length&&n[u].setMap(null);u++;w++;d.push(tt)}if(u<n.length)for(h=u;h<n.length;h++)n[h].setMap(null);n=d;i===!0&&(it=new google.maps.LatLngBounds(new google.maps.LatLng(v,p),new google.maps.LatLng(a,y)),r.fitBounds(it,Math.max($(document).width(),$(document).height())*.02));navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){userLoc=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);s&&s.setMap(null);s=new google.maps.Marker({position:userLoc,icon:nt(c()),label:{text:"I am here",color:"#2916BE",fontSize:"16px",fontWeight:"bold"},zindex:st,map:r})})}}var et={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},f={},n=[],e=null,a=null,t={},o={},ot=new Set,u=[],s=null,h=null,p="",v=[[16,1.8],[15,1.5],[14,1.2]],w=1e4,st=99999,r=new google.maps.Map(document.getElementById("map"),{zoom:13,panControl:!0,zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,overviewMapControl:!0,rotateControl:!0}),y,l;$("#main-form").submit(function(n){var t=document.getElementById("route").value.trim();if(t===""||t===p)n.preventDefault();else return!0});google.maps.event.addListener(r,"zoom_changed",function(){ht(c())});$("#directionOptions").on("change",".directionRadio",function(){k()});$(document.body).bind("mousemove keydown click",d);document.getElementById("route").onfocus=function(){document.getElementById("directionForm").classList.add("fade");document.getElementById("map").classList.add("fade");document.getElementById("btn-traffic").classList.add("fade")};document.getElementById("route").onblur=function(){document.getElementById("directionForm").classList.remove("fade");document.getElementById("map").classList.remove("fade");document.getElementById("btn-traffic").classList.remove("fade")};document.getElementById("btn-traffic").onclick=function(){h===null?(h=new google.maps.TrafficLayer,h.setMap(r),this.classList.remove("btn-outline-success"),this.classList.add("btn-success")):(h.setMap(null),h=null,this.classList.add("btn-outline-success"),this.classList.remove("btn-success"))};y=new URLSearchParams(window.location.search);y.has("route")&&(l=y.get("route"),document.getElementById("route").value=l,p=l,document.title="Bus Location: "+l,document.getElementById("loading").classList.remove("hidden"),ct(),d(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){initialLocation=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);r.setCenter(initialLocation)}),setInterval(function(){t={};o={};ot.clear()},864e5))})();