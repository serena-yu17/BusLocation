function escapeHtml(n){return String(n).replace(/[&<>"'`=\/]/g,function(n){return entityMap[n]})}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},map=new google.maps.Map(document.getElementById("map"),{zoom:13,panControl:!0,zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,overviewMapControl:!0,rotateControl:!0}),radioToggle=null;$(document).ready(function(){function s(){for(var t=map.getZoom(),n=0;n<c.length;n++)if(t>=c[n][0])return c[n][1];return 1}function k(t){if(n)for(var i=0;i<n.length;i++)n[i].setIcon(a(t));if(r)for(i=0;i<r.length;i++)r[i].setIcon(y(t));e&&e.setIcon(v(t))}function a(n){var t=Math.max($(document).width(),$(document).height())*.015;return n!==undefined&&(t*=n),{url:"/images/Bus.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/2,t/2),labelOrigin:new google.maps.Point(t/2,-t/8)}}function v(n){var t=Math.max($(document).width(),$(document).height())*.015;return n!==undefined&&(t*=n),{url:"/images/crosshair.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/2,t/2),labelOrigin:new google.maps.Point(t*.75,-t/6)}}function y(n){var t=Math.max($(document).width(),$(document).height())*.006;return n!==undefined&&(t*=n),{url:"/images/dot-orange.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/3,t/3)}}function d(){u=setInterval(function(){if(document.getElementById("map").classList.contains("hidden")){u&&clearInterval(u);return}p()},15e3);h&&clearTimeout(h);h=setTimeout(function(){u&&clearInterval(u)},6e5)}function g(){var t=document.getElementById("route"),n=t.value.trim();n!=""&&(document.getElementById("searchRoute").disabled=!0,document.getElementById("map").classList.add("hidden"),document.getElementById("btn-traffic").classList.add("hidden"),$.ajax({type:"GET",url:tripUrl,data:{route:n},success:function(n){it(n)},error:function(n){console.log(n)},complete:function(){document.getElementById("searchRoute").disabled=!1;waitingUpd=!1}}))}function p(n){var r=null,f,h,e,o,s,u,c;for(f in t)if(t.hasOwnProperty(f)&&(h=t[f].radID,e=document.getElementById(h),e&&e.checked)){r=t[f].trips;break}if(r!==null&&r.length!==0){for(o=[],s=[],u=0;u<r.length;u++)o.push(r[u].toString()),!i.hasOwnProperty(r[u])&&n&&s.push(r[u]);n&&nt(s,r);c={tripIDs:o.join(",")};$.ajax({type:"GET",url:locUrl,data:c,cache:!1,success:function(t){rt(t,n)},error:function(n){console.log(n)}})}}function nt(n,t){for(var u=[],r=0;r<n.length;r++)u.push(n[r].toString());$.ajax({type:"GET",url:stopUrl,data:{tripIDs:u.join(",")},success:function(n){var u,e,o;if(n&&n.length!==0){for(u in n)if(n.hasOwnProperty(u))for(e=n[u],i.hasOwnProperty(u)||(i[u]=[]),f.hasOwnProperty(u)||(f[u]=new Set),r=0;r<e.length;r++)o=e[r].latitude.toString()+"&"+e[r].longitude.toString(),f[u].has(o)||(i[u].push(e[r]),f[u].add(o));tt(t)}},error:function(n){console.log(n)}})}function tt(n){for(var e,f,u,o,h,t=0;t<r.length;t++)r[t].setMap(null);if(r.length=0,n&&n.length!==0)for(e=new Set,t=0;t<n.length;t++)if(i.hasOwnProperty(n[t])&&i[n[t]])for(f=i[n[t]],u=0;u<f.length;u++)o=f[u].latitude.toString()+"&"+f[u].longitude.toString(),e.has(o)||(h=new google.maps.Marker({position:new google.maps.LatLng(f[u].latitude,f[u].longitude),icon:y(s()),map:map}),r.push(h),e.add(o))}function it(n){var e,i,r,u,f,o,s;if(n){e=!0;for(i in n)if(n.hasOwnProperty(i)){e=!1;break}if(e){document.getElementById("directionForm").classList.add("hidden");document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";return}document.getElementById("directionForm").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");r=0;for(i in n)n.hasOwnProperty(i)&&(u=document.createElement("label"),u.classList.add("form-control"),f="directionRadio"+r.toString(),o='<input type="radio" name="direction" id="'+f+'" onclick="radioToggle();"/> '+escapeHtml(i),r===0&&(o='<input type="radio" name="direction" id="'+f+'" onclick="radioToggle();" checked/> '+escapeHtml(i)),u.innerHTML=o,s="directionOption"+r.toString(),u.id=s,document.getElementById("directionOptions").appendChild(u),t[s]={radID:f,trips:n[i]},r++);document.getElementById("directionRadio0")&&document.getElementById("directionRadio0").focus();radioToggle()}}function rt(t,i){var c,g,u,tt,h,it;if(t){c=!0;for(g in t)if(t.hasOwnProperty(g)){c=!1;break}if(c){document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";document.getElementById("map").classList.add("hidden");document.getElementById("btn-traffic").classList.add("hidden");return}document.getElementById("map").classList.remove("hidden");document.getElementById("btn-traffic").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");var nt=[],r=0,y=-1e4,p=1e4,w=-1e4,k=1e4;for(u in t)if(t.hasOwnProperty(u)){var f=t[u].coordinate.latitude,o=t[u].coordinate.longitude,d=t[u].occupancy;d||(d=" ");i===!0&&(f>y&&(y=f),f<p&&(p=f),o>w&&(w=o),o<k&&(k=o));tt=new google.maps.Marker({position:new google.maps.LatLng(f,o),icon:a(s()),label:{text:d,color:"#BE1616",fontSize:"16px",fontWeight:"bold"},zIndex:l,map:map});r<n.length&&n[r].setMap(null);r++;l++;nt.push(tt)}if(r<n.length)for(h=r;h<n.length;h++)n[h].setMap(null);n=nt;i===!0&&(it=new google.maps.LatLngBounds(new google.maps.LatLng(p,k),new google.maps.LatLng(y,w)),map.fitBounds(it,Math.max($(document).width(),$(document).height())*.02));navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){userLoc=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);e&&e.setMap(null);e=new google.maps.Marker({position:userLoc,icon:v(s()),label:{text:"I am here",color:"#2916BE",fontSize:"16px",fontWeight:"bold"},zindex:b,map:map})})}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){initialLocation=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);map.setCenter(initialLocation)});var t={},n=[],u=null,h=null,i={},f={},w=new Set,r=[],e=null,o=null,c=[[16,1.8],[15,1.5],[14,1.2]],l=1e4,b=99999;setInterval(function(){i={};f={};w.clear()},864e5);document.getElementById("searchRoute").onclick=function(n){var r,i;n.preventDefault();for(r in t)t.hasOwnProperty(r)&&(i=document.getElementById(r),i&&i.parentElement.removeChild(i));t={};g()};document.getElementById("route").onfocus=function(){document.getElementById("directionForm").classList.add("fade");document.getElementById("map").classList.add("fade");document.getElementById("btn-traffic").classList.add("fade")};document.getElementById("route").onblur=function(){document.getElementById("directionForm").classList.remove("fade");document.getElementById("map").classList.remove("fade");document.getElementById("btn-traffic").classList.remove("fade")};document.getElementById("btn-traffic").onclick=function(){o===null?(o=new google.maps.TrafficLayer,o.setMap(map),this.classList.remove("btn-outline-success"),this.classList.add("btn-success")):(o.setMap(null),o=null,this.classList.add("btn-outline-success"),this.classList.remove("btn-success"))};google.maps.event.addListener(map,"zoom_changed",function(){k(s())});radioToggle=function(){p(!0);d()}});