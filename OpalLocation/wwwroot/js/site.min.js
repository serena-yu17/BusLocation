function escapeHtml(n){return String(n).replace(/[&<>"'`=\/]/g,function(n){return entityMap[n]})}const entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};$(document).ready(function(){function y(){i=setInterval(function(){if(document.getElementById("map").classList.contains("hidden")){i&&clearInterval(i);return}o()},15e3);e&&clearTimeout(e);e=setTimeout(function(){i&&clearInterval(i)},6e5)}function p(){var t=document.getElementById("route"),n=t.value.trim();n!=""&&(document.getElementById("searchRoute").disabled=!0,document.getElementById("map").classList.add("hidden"),$.ajax({type:"GET",url:tripUrl,data:{route:n},success:function(n){k(n)},error:function(n){console.log(n)},complete:function(){document.getElementById("searchRoute").disabled=!1;waitingUpd=!1}}))}function o(i=false){let r=null;for(let t in n)if(n.hasOwnProperty(t)){var u=n[t].radID;let i=document.getElementById(u);if(i&&i.checked){r=n[t].trips;break}}if(r!==null&&r.length!==0){let n=[],u=[];for(let i=0;i<r.length;i++)n.push(r[i].toString()),t.hasOwnProperty(r[i])||u.push(r[i]);w(u,r);let f={tripIDs:n.join(",")};i&&(document.getElementById("submit").disabled=!0);$.ajax({type:"GET",url:locUrl,data:f,cache:!1,success:function(n){d(n,i)},error:function(n){console.log(n)},complete:function(){document.getElementById("submit").disabled=!1}})}}function w(n,i){var u=[];for(let t=0;t<n.length;t++)u.push(n[t].toString());$.ajax({type:"GET",url:stopUrl,data:{tripIDs:u.join(",")},success:function(n){var u,f;if(n&&n.length!==0){for(let i in n)if(n.hasOwnProperty(i)){u=n[i];t.hasOwnProperty(i)||(t[i]=[]);r.hasOwnProperty(i)||(r[i]=new Set);for(let n=0;n<u.length;n++)f=u[n].latitude.toString()+"&"+u[n].longitude.toString(),r[i].has(f)||(t[i].push(u[n]),r[i].add(f))}b(i)}},error:function(n){console.log(n)}})}function b(n){for(let n=0;n<f.length;n++)f[n].setMap(null);if(f.length=0,n&&n.length!==0){let r=new Set;for(let u=0;u<n.length;u++)if(t.hasOwnProperty(n[u])&&t[n[u]]){var i=t[n[u]];for(let n=0;n<i.length;n++){let t=i[n].latitude.toString()+"&"+i[n].longitude.toString();if(!r.has(t)){let u=new google.maps.Marker({position:new google.maps.LatLng(i[n].latitude,i[n].longitude),icon:a,map:map});f.push(u);r.add(t)}}}}}function k(t){if(t){let r=!0;for(let n in t)if(t.hasOwnProperty(n)){r=!1;break}if(r){document.getElementById("directionForm").classList.add("hidden");return}document.getElementById("directionForm").classList.remove("hidden");let i=0;for(let r in t)if(t.hasOwnProperty(r)){let u=document.createElement("label");u.classList.add("form-control");let f="directionRadio"+i.toString(),e='<input type="radio" name="direction" id="'+f+'"/> '+escapeHtml(r);i===0&&(e='<input type="radio" name="direction" id="'+f+'" checked/> '+escapeHtml(r));u.innerHTML=e;let o="directionOption"+i.toString();u.id=o;document.getElementById("directionOptions").appendChild(u);n[o]={radID:f,trips:t[r]};i++}}}function d(n,t=false){if(n){let r=!0;for(let t in n)if(n.hasOwnProperty(t)){r=!1;break}if(r){document.getElementById("map").classList.add("hidden");return}document.getElementById("map").classList.remove("hidden");for(let n=0;n<u.length;n++)u[n].setMap(null);u.length=0;let f=0,e=0,i=0;for(let r in n)if(n.hasOwnProperty(r)){let o=n[r].coordinate.latitude,s=n[r].coordinate.longitude,h=n[r].occupancy;t&&(f+=o,e+=s,i++);let l=new google.maps.Marker({position:new google.maps.LatLng(o,s),icon:c,label:{text:h,color:"#BE1616",fontSize:"16px",fontWeight:"bold"},map:map});u.push(l)}if(t){let n=f/i,t=e/i,r=new google.maps.LatLng(n,t);map.setCenter(r)}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){userLoc=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);let t=new google.maps.Marker({position:userLoc,icon:l,label:{text:"I am here",color:"#2916BE",fontSize:"16px",fontWeight:"bold"},map:map})})}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){initialLocation=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);map.setCenter(initialLocation)});const c={url:"/images/Bus.svg",scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15),labelOrigin:new google.maps.Point(0,-5)},l={url:"/images/crosshair.svg",scaledSize:new google.maps.Size(20,20),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20),labelOrigin:new google.maps.Point(15,-5)},a={url:"/images/stop.svg",scaledSize:new google.maps.Size(15,15),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(5,5)};var n={},u=[],i=null,e=null,t={},r={},v=new Set,f=[];setInterval(function(){t={};r={};v.clear()},864e5);document.getElementById("searchRoute").onclick=function(){event.preventDefault();for(let t in n)if(n.hasOwnProperty(t)){let n=document.getElementById(t);n&&n.parentElement.removeChild(n)}n={};p()};document.getElementById("submit").onclick=function(){event.preventDefault();o(!0);y()}});