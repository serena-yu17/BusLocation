function escapeHtml(n){return String(n).replace(/[&<>"'`=\/]/g,function(n){return entityMap[n]})}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},radioToggle=null;$(document).ready(function(){function y(){var n=Math.max($(document).width(),$(document).height())*.015;return{url:"/images/Bus.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/2,n/2),labelOrigin:new google.maps.Point(n/2,-n/8)}}function p(){var n=Math.max($(document).width(),$(document).height())*.015;return{url:"/images/crosshair.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/2,n/2),labelOrigin:new google.maps.Point(n*.75,-n/6)}}function w(){var n=Math.max($(document).width(),$(document).height())*.006;return{url:"/images/dot-orange.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/3,n/3)}}function b(){i=setInterval(function(){if(document.getElementById("map").classList.contains("hidden")){i&&clearInterval(i);return}h()},15e3);e&&clearTimeout(e);e=setTimeout(function(){i&&clearInterval(i)},6e5)}function k(){var t=document.getElementById("route"),n=t.value.trim();n!=""&&(document.getElementById("searchRoute").disabled=!0,document.getElementById("map").classList.add("hidden"),$.ajax({type:"GET",url:tripUrl,data:{route:n},success:function(n){nt(n)},error:function(n){console.log(n)},complete:function(){document.getElementById("searchRoute").disabled=!1;waitingUpd=!1}}))}function h(i){var r=null,f,h,e,o,s,u,c;for(f in n)if(n.hasOwnProperty(f)&&(h=n[f].radID,e=document.getElementById(h),e&&e.checked)){r=n[f].trips;break}if(r!==null&&r.length!==0){for(o=[],s=[],u=0;u<r.length;u++)o.push(r[u].toString()),t.hasOwnProperty(r[u])||s.push(r[u]);d(s,r);c={tripIDs:o.join(",")};$.ajax({type:"GET",url:locUrl,data:c,cache:!1,success:function(n){tt(n,i)},error:function(n){console.log(n)}})}}function d(n,i){for(var f=[],u=0;u<n.length;u++)f.push(n[u].toString());$.ajax({type:"GET",url:stopUrl,data:{tripIDs:f.join(",")},success:function(n){var f,e,o;if(n&&n.length!==0){for(f in n)if(n.hasOwnProperty(f))for(e=n[f],t.hasOwnProperty(f)||(t[f]=[]),r.hasOwnProperty(f)||(r[f]=new Set),u=0;u<e.length;u++)o=e[u].latitude.toString()+"&"+e[u].longitude.toString(),r[f].has(o)||(t[f].push(e[u]),r[f].add(o));g(i)}},error:function(n){console.log(n)}})}function g(n){for(var e,u,r,o,s,i=0;i<f.length;i++)f[i].setMap(null);if(f.length=0,n&&n.length!==0)for(e=new Set,i=0;i<n.length;i++)if(t.hasOwnProperty(n[i])&&t[n[i]])for(u=t[n[i]],r=0;r<u.length;r++)o=u[r].latitude.toString()+"&"+u[r].longitude.toString(),e.has(o)||(s=new google.maps.Marker({position:new google.maps.LatLng(u[r].latitude,u[r].longitude),icon:w(),map:map}),f.push(s),e.add(o))}function nt(t){var e,i,r,u,f,o,s;if(t){e=!0;for(i in t)if(t.hasOwnProperty(i)){e=!1;break}if(e){document.getElementById("directionForm").classList.add("hidden");return}document.getElementById("directionForm").classList.remove("hidden");r=0;for(i in t)t.hasOwnProperty(i)&&(u=document.createElement("label"),u.classList.add("form-control"),f="directionRadio"+r.toString(),o='<input type="radio" name="direction" id="'+f+'" onclick="radioToggle();"/> '+escapeHtml(i),r===0&&(o='<input type="radio" name="direction" id="'+f+'" onclick="radioToggle();" checked/> '+escapeHtml(i)),u.innerHTML=o,s="directionOption"+r.toString(),u.id=s,document.getElementById("directionOptions").appendChild(u),n[s]={radID:f,trips:t[i]},r++);document.getElementById("directionRadio0")&&document.getElementById("directionRadio0").focus();radioToggle()}}function tt(n,t){var f,c,r,i,k;if(n){f=!0;for(c in n)if(n.hasOwnProperty(c)){f=!1;break}if(f){document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";document.getElementById("map").classList.add("hidden");return}for(document.getElementById("map").classList.remove("hidden"),document.getElementById("prompt").classList.add("hidden"),r=0;r<u.length;r++)u[r].setMap(null);u.length=0;var l=0,a=0,e=0;for(i in n)if(n.hasOwnProperty(i)){var w=n[i].coordinate.latitude,b=n[i].coordinate.longitude,h=n[i].occupancy;h||(h=" ");t===!0&&(l+=w,a+=b,e++);k=new google.maps.Marker({position:new google.maps.LatLng(w,b),icon:y(),label:{text:h,color:"#BE1616",fontSize:"16px",fontWeight:"bold"},zIndex:s,map:map});s++;u.push(k)}if(t===!0){var d=l/e,g=a/e,nt=new google.maps.LatLng(d,g);map.setCenter(nt)}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){userLoc=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);o&&o.setMap(null);o=new google.maps.Marker({position:userLoc,icon:p(),label:{text:"I am here",color:"#2916BE",fontSize:"16px",fontWeight:"bold"},zindex:v,map:map})})}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){initialLocation=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);map.setCenter(initialLocation)});var n={},u=[],i=null,e=null,t={},r={},a=new Set,f=[],o=null,s=1e4,v=99999;setInterval(function(){t={};r={};a.clear()},864e5);document.getElementById("searchRoute").onclick=function(t){var r,i;t.preventDefault();for(r in n)n.hasOwnProperty(r)&&(i=document.getElementById(r),i&&i.parentElement.removeChild(i));n={};k()};document.getElementById("route").onfocus=function(){document.getElementById("directionForm").classList.add("fade");document.getElementById("map").classList.add("fade")};document.getElementById("route").onblur=function(){document.getElementById("directionForm").classList.remove("fade");document.getElementById("map").classList.remove("fade")};radioToggle=function(){h(!0);b()}});