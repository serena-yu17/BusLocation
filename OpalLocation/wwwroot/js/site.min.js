function escapeHtml(n){return String(n).replace(/[&<>"'`=\/]/g,function(n){return entityMap[n]})}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},map=new google.maps.Map(document.getElementById("map"),{zoom:13}),radioToggle=null;$(document).ready(function(){function a(){var n=Math.max($(document).width(),$(document).height())*.015;return{url:"/images/Bus.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/2,n/2),labelOrigin:new google.maps.Point(n/2,-n/8)}}function v(){var n=Math.max($(document).width(),$(document).height())*.015;return{url:"/images/crosshair.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/2,n/2),labelOrigin:new google.maps.Point(n*.75,-n/6)}}function y(){var n=Math.max($(document).width(),$(document).height())*.006;return{url:"/images/dot-orange.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/3,n/3)}}function p(){r=setInterval(function(){if(document.getElementById("map").classList.contains("hidden")){r&&clearInterval(r);return}h()},15e3);e&&clearTimeout(e);e=setTimeout(function(){r&&clearInterval(r)},6e5)}function w(){var t=document.getElementById("route"),n=t.value.trim();n!=""&&(document.getElementById("searchRoute").disabled=!0,document.getElementById("map").classList.add("hidden"),$.ajax({type:"GET",url:tripUrl,data:{route:n},success:function(n){d(n)},error:function(n){console.log(n)},complete:function(){document.getElementById("searchRoute").disabled=!1;waitingUpd=!1}}))}function h(i){var r=null,f,h,e,o,s,u,c;for(f in n)if(n.hasOwnProperty(f)&&(h=n[f].radID,e=document.getElementById(h),e&&e.checked)){r=n[f].trips;break}if(r!==null&&r.length!==0){for(o=[],s=[],u=0;u<r.length;u++)o.push(r[u].toString()),!t.hasOwnProperty(r[u])&&i&&s.push(r[u]);i&&b(s,r);c={tripIDs:o.join(",")};$.ajax({type:"GET",url:locUrl,data:c,cache:!1,success:function(n){g(n,i)},error:function(n){console.log(n)}})}}function b(n,i){for(var f=[],r=0;r<n.length;r++)f.push(n[r].toString());$.ajax({type:"GET",url:stopUrl,data:{tripIDs:f.join(",")},success:function(n){var f,e,o;if(n&&n.length!==0){for(f in n)if(n.hasOwnProperty(f))for(e=n[f],t.hasOwnProperty(f)||(t[f]=[]),u.hasOwnProperty(f)||(u[f]=new Set),r=0;r<e.length;r++)o=e[r].latitude.toString()+"&"+e[r].longitude.toString(),u[f].has(o)||(t[f].push(e[r]),u[f].add(o));k(i)}},error:function(n){console.log(n)}})}function k(n){for(var e,u,r,o,s,i=0;i<f.length;i++)f[i].setMap(null);if(f.length=0,n&&n.length!==0)for(e=new Set,i=0;i<n.length;i++)if(t.hasOwnProperty(n[i])&&t[n[i]])for(u=t[n[i]],r=0;r<u.length;r++)o=u[r].latitude.toString()+"&"+u[r].longitude.toString(),e.has(o)||(s=new google.maps.Marker({position:new google.maps.LatLng(u[r].latitude,u[r].longitude),icon:y(),map:map}),f.push(s),e.add(o))}function d(t){var e,i,r,u,f,o,s;if(t){e=!0;for(i in t)if(t.hasOwnProperty(i)){e=!1;break}if(e){document.getElementById("directionForm").classList.add("hidden");return}document.getElementById("directionForm").classList.remove("hidden");r=0;for(i in t)t.hasOwnProperty(i)&&(u=document.createElement("label"),u.classList.add("form-control"),f="directionRadio"+r.toString(),o='<input type="radio" name="direction" id="'+f+'" onclick="radioToggle();"/> '+escapeHtml(i),r===0&&(o='<input type="radio" name="direction" id="'+f+'" onclick="radioToggle();" checked/> '+escapeHtml(i)),u.innerHTML=o,s="directionOption"+r.toString(),u.id=s,document.getElementById("directionOptions").appendChild(u),n[s]={radID:f,trips:t[i]},r++);document.getElementById("directionRadio0")&&document.getElementById("directionRadio0").focus();radioToggle()}}function g(n,t){var c,d,u,nt,h,tt;if(n){c=!0;for(d in n)if(n.hasOwnProperty(d)){c=!1;break}if(c){document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";document.getElementById("map").classList.add("hidden");return}document.getElementById("map").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");var g=[],r=0,y=-1e4,p=1e4,w=-1e4,b=1e4;for(u in n)if(n.hasOwnProperty(u)){var f=n[u].coordinate.latitude,e=n[u].coordinate.longitude,k=n[u].occupancy;k||(k=" ");t===!0&&(f>y&&(y=f),f<p&&(p=f),e>w&&(w=e),e<b&&(b=e));nt=new google.maps.Marker({position:new google.maps.LatLng(f,e),icon:a(),label:{text:k,color:"#BE1616",fontSize:"16px",fontWeight:"bold"},zIndex:s,map:map});r<i.length&&i[r].setMap(null);r++;s++;g.push(nt)}if(r<i.length)for(h=r;h<i.length;h++)i[h].setMap(null);i=g;t===!0&&(tt=new google.maps.LatLngBounds(new google.maps.LatLng(p,b),new google.maps.LatLng(y,w)),map.fitBounds(tt,Math.max($(document).width(),$(document).height())*.02));navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){userLoc=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);o&&o.setMap(null);o=new google.maps.Marker({position:userLoc,icon:v(),label:{text:"I am here",color:"#2916BE",fontSize:"16px",fontWeight:"bold"},zindex:l,map:map})})}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){initialLocation=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);map.setCenter(initialLocation)});var n={},i=[],r=null,e=null,t={},u={},c=new Set,f=[],o=null,s=1e4,l=99999;setInterval(function(){t={};u={};c.clear()},864e5);document.getElementById("searchRoute").onclick=function(t){var r,i;t.preventDefault();for(r in n)n.hasOwnProperty(r)&&(i=document.getElementById(r),i&&i.parentElement.removeChild(i));n={};w()};document.getElementById("route").onfocus=function(){document.getElementById("directionForm").classList.add("fade");document.getElementById("map").classList.add("fade")};document.getElementById("route").onblur=function(){document.getElementById("directionForm").classList.remove("fade");document.getElementById("map").classList.remove("fade")};radioToggle=function(){h(!0);p()}});