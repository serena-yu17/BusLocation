function escapeHtml(n){return String(n).replace(/[&<>"'`=\/]/g,function(n){return entityMap[n]})}const entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};$(document).ready(function(){function a(){var n=Math.min($(document).width(),$(document).height())*.04;return{url:"/images/Bus.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/2,n/2),labelOrigin:new google.maps.Point(n/2,-n/8)}}function v(){var n=Math.min($(document).width(),$(document).height())*.02;return{url:"/images/crosshair.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/2,n/2),labelOrigin:new google.maps.Point(n*.75,-n/6)}}function y(){var n=Math.min($(document).width(),$(document).height())*.015;return{url:"/images/stop.svg",scaledSize:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/3,n/3)}}function p(){i=setInterval(function(){if(document.getElementById("map").classList.contains("hidden")){i&&clearInterval(i);return}s()},15e3);e&&clearTimeout(e);e=setTimeout(function(){i&&clearInterval(i)},6e5)}function w(){var t=document.getElementById("route"),n=t.value.trim();n!=""&&(document.getElementById("searchRoute").disabled=!0,document.getElementById("map").classList.add("hidden"),$.ajax({type:"GET",url:tripUrl,data:{route:n},success:function(n){d(n)},error:function(n){console.log(n)},complete:function(){document.getElementById("searchRoute").disabled=!1;waitingUpd=!1}}))}function s(i=false){let r=null;for(let t in n)if(n.hasOwnProperty(t)){var u=n[t].radID;let i=document.getElementById(u);if(i&&i.checked){r=n[t].trips;break}}if(r!==null&&r.length!==0){let n=[],u=[];for(let i=0;i<r.length;i++)n.push(r[i].toString()),t.hasOwnProperty(r[i])||u.push(r[i]);b(u,r);let f={tripIDs:n.join(",")};i&&(document.getElementById("submit").disabled=!0);$.ajax({type:"GET",url:locUrl,data:f,cache:!1,success:function(n){g(n,i)},error:function(n){console.log(n)},complete:function(){document.getElementById("submit").disabled=!1}})}}function b(n,i){var u=[];for(let t=0;t<n.length;t++)u.push(n[t].toString());$.ajax({type:"GET",url:stopUrl,data:{tripIDs:u.join(",")},success:function(n){var u,f;if(n&&n.length!==0){for(let i in n)if(n.hasOwnProperty(i)){u=n[i];t.hasOwnProperty(i)||(t[i]=[]);r.hasOwnProperty(i)||(r[i]=new Set);for(let n=0;n<u.length;n++)f=u[n].latitude.toString()+"&"+u[n].longitude.toString(),r[i].has(f)||(t[i].push(u[n]),r[i].add(f))}k(i)}},error:function(n){console.log(n)}})}function k(n){for(let n=0;n<f.length;n++)f[n].setMap(null);if(f.length=0,n&&n.length!==0){let r=new Set;for(let u=0;u<n.length;u++)if(t.hasOwnProperty(n[u])&&t[n[u]]){var i=t[n[u]];for(let n=0;n<i.length;n++){let t=i[n].latitude.toString()+"&"+i[n].longitude.toString();if(!r.has(t)){let u=new google.maps.Marker({position:new google.maps.LatLng(i[n].latitude,i[n].longitude),icon:y(),map:map});f.push(u);r.add(t)}}}}}function d(t){if(t){let r=!0;for(let n in t)if(t.hasOwnProperty(n)){r=!1;break}if(r){document.getElementById("directionForm").classList.add("hidden");return}document.getElementById("directionForm").classList.remove("hidden");let i=0;for(let r in t)if(t.hasOwnProperty(r)){let u=document.createElement("label");u.classList.add("form-control");let f="directionRadio"+i.toString(),e='<input type="radio" name="direction" id="'+f+'"/> '+escapeHtml(r);i===0&&(e='<input type="radio" name="direction" id="'+f+'" checked/> '+escapeHtml(r));u.innerHTML=e;let o="directionOption"+i.toString();u.id=o;document.getElementById("directionOptions").appendChild(u);n[o]={radID:f,trips:t[r]};i++}document.getElementById("directionRadio0")&&document.getElementById("directionRadio0").focus()}}function g(n,t=false){if(n){let r=!0;for(let t in n)if(n.hasOwnProperty(t)){r=!1;break}if(r){document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";document.getElementById("map").classList.add("hidden");return}document.getElementById("map").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");for(let n=0;n<u.length;n++)u[n].setMap(null);u.length=0;let f=0,e=0,i=0;for(let r in n)if(n.hasOwnProperty(r)){let s=n[r].coordinate.latitude,h=n[r].coordinate.longitude,o=n[r].occupancy;o||(o=" ");t&&(f+=s,e+=h,i++);let c=new google.maps.Marker({position:new google.maps.LatLng(s,h),icon:a(),label:{text:o,color:"#BE1616",fontSize:"16px",fontWeight:"bold"},map:map});u.push(c)}if(t){let n=f/i,t=e/i,r=new google.maps.LatLng(n,t);map.setCenter(r)}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){userLoc=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);o&&o.setMap(null);o=new google.maps.Marker({position:userLoc,icon:v(),label:{text:"I am here",color:"#2916BE",fontSize:"16px",fontWeight:"bold"},map:map})})}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){initialLocation=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);map.setCenter(initialLocation)});var n={},u=[],i=null,e=null,t={},r={},l=new Set,f=[],o=null;setInterval(function(){t={};r={};l.clear()},864e5);document.getElementById("searchRoute").onclick=function(){event.preventDefault();for(let t in n)if(n.hasOwnProperty(t)){let n=document.getElementById(t);n&&n.parentElement.removeChild(n)}n={};w()};document.getElementById("submit").onclick=function(){event.preventDefault();s(!0);p()};document.getElementById("route").onfocus=function(){document.getElementById("directionForm").classList.add("fade");document.getElementById("map").classList.add("fade")};document.getElementById("route").onblur=function(){document.getElementById("directionForm").classList.remove("fade");document.getElementById("map").classList.remove("fade")}});