(function(){function b(){tt(!0)}function k(){e||(e=setInterval(function(){document.getElementById("map").classList.contains("hidden")||tt()},15e3));a&&clearTimeout(a);a=setTimeout(function(){e&&(clearInterval(e),e=null)},6e5)}function c(){for(var t=r.getZoom(),n=0;n<v.length;n++)if(t>=v[n][0])return v[n][1];return 1}function st(t){if(n)for(var i=0;i<n.length;i++)n[i].setIcon(d(t));if(u)for(i=0;i<u.length;i++)u[i].setIcon(nt(t));s&&s.setIcon(g(t))}function d(n){var t=Math.max($(document).width(),$(document).height())*.015;return n!==undefined&&(t*=n),{url:"/images/Bus.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/2,t/2),labelOrigin:new google.maps.Point(t/2,-t/8)}}function g(n){var t=Math.max($(document).width(),$(document).height())*.015;return n!==undefined&&(t*=n),{url:"/images/crosshair.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/2,t/2),labelOrigin:new google.maps.Point(t*.75,-t/6)}}function nt(n){var t=Math.max($(document).width(),$(document).height())*.006;return n!==undefined&&(t*=n),{url:"/images/dot-orange.svg",scaledSize:new google.maps.Size(t,t),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(t/3,t/3)}}function ht(){var r=document.getElementById("route"),n=r.value.trim(),t,i;if(n!==""){if(document.getElementById("map").classList.add("hidden"),document.getElementById("btn-traffic").classList.add("hidden"),window.sessionStorage&&(t=window.sessionStorage.getItem(n),t)){i=JSON.parse(t);rt(i);document.getElementById("loading").classList.add("hidden");return}$.ajax({type:"GET",url:tripUrl,data:{route:n},success:function(t){rt(t);window.localStorage&&window.localStorage.setItem(n,JSON.stringify(t))},error:function(n){console.log(n)},complete:function(){document.getElementById("loading").classList.add("hidden")}})}}function tt(n){var i=null,u,a,e,o,s,r,h,c,l,v;for(u in f)if(f.hasOwnProperty(u)&&(a=f[u].radID,e=document.getElementById(a),e&&e.checked)){i=f[u].trips;break}if(i!==null&&i.length!==0){for(o=[],s=[],r=0;r<i.length;r++)o.push(i[r].toString()),!t.hasOwnProperty(i[r])&&n&&s.push(i[r]);if(n&&ct(s,i),h={tripIDs:o.join(",")},c=JSON.stringify(h),window.sessionStorage&&(l=window.sessionStorage.getItem(c),l)){v=JSON.parse(l);ut(v,n);return}$.ajax({type:"GET",url:locUrl,data:h,cache:!1,success:function(t){window.sessionStorage&&window.sessionStorage.setItem(c,JSON.stringify(t));ut(t,n)},error:function(n){console.log(n)}})}}function ct(n,t){for(var e,u,f,o,i=[],r=0;r<n.length;r++)i.push(n[r].toString());if(e={tripIDs:i.join(",")},u=JSON.stringify(e),window.sessionStorage&&(f=window.sessionStorage.getItem(u),f)){o=JSON.parse(f);it(o,t);return}$.ajax({type:"GET",url:stopUrl,data:{tripIDs:i.join(",")},success:function(n){window.sessionStorage&&window.sessionStorage.setItem(u,JSON.stringify(n));it(n,t)},error:function(n){console.log(n)}})}function it(n,r){var u,f,e;if(n&&n.length!==0){for(u in n)if(n.hasOwnProperty(u))for(f=n[u],t.hasOwnProperty(u)||(t[u]=[]),o.hasOwnProperty(u)||(o[u]=new Set),i=0;i<f.length;i++)e=f[i].latitude.toString()+"&"+f[i].longitude.toString(),o[u].has(e)||(t[u].push(f[i]),o[u].add(e));lt(r)}}function lt(n){for(var o,e,f,s,h,i=0;i<u.length;i++)u[i].setMap(null);if(u.length=0,n&&n.length!==0)for(o=new Set,i=0;i<n.length;i++)if(t.hasOwnProperty(n[i])&&t[n[i]])for(e=t[n[i]],f=0;f<e.length;f++)s=e[f].latitude.toString()+"&"+e[f].longitude.toString(),o.has(s)||(h=new google.maps.Marker({position:new google.maps.LatLng(e[f].latitude,e[f].longitude),icon:nt(c()),map:r}),u.push(h),o.add(s))}function rt(n){var o,i,u,e,r,s,t,h,c;if(n){o=!0;for(i in n)if(n.hasOwnProperty(i)){o=!1;break}if(o){document.getElementById("directionForm").classList.add("hidden");document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";return}document.getElementById("directionForm").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");u=0;e=null;for(i in n)n.hasOwnProperty(i)&&(r=document.createElement("label"),document.getElementById("directionOptions").appendChild(r),r.classList.add("form-control"),s="directionRadio"+u.toString(),t=document.createElement("input"),t.type="radio",t.classList.add("directionRadio"),t.name="direction",t.id=s,u===0?(t.checked=!0,e=t):t.checked=!1,r.appendChild(t),h="directionOption"+u.toString(),r.id=h,f[h]={radID:s,trips:n[i]},c=document.createElement("span"),c.innerText=" "+i,r.appendChild(c),u++);e&&e.focus();b()}}function ut(t,i){var a,k,f,it,l,rt;if(t){a=!0;for(k in t)if(t.hasOwnProperty(k)){a=!1;break}if(a){document.getElementById("prompt").classList.remove("hidden");document.getElementById("prompt").innerHTML="No vehicles active were found.";document.getElementById("map").classList.add("hidden");document.getElementById("btn-traffic").classList.add("hidden");return}document.getElementById("map").classList.remove("hidden");document.getElementById("btn-traffic").classList.remove("hidden");document.getElementById("prompt").classList.add("hidden");var nt=[],u=0,v=-1e4,y=1e4,p=-1e4,b=1e4;for(f in t)if(t.hasOwnProperty(f)){var e=t[f].coordinate.latitude,o=t[f].coordinate.longitude,h=t[f].occupancy,tt="";(h!==null||h!==undefined||h<occupancyStatus.length)&&(tt=occupancyStatus[h]);i===!0&&(e>v&&(v=e),e<y&&(y=e),o>p&&(p=o),o<b&&(b=o));it=new google.maps.Marker({position:new google.maps.LatLng(e,o),icon:d(c()),label:{text:tt,color:"#BE1616",fontSize:"16px",fontWeight:"bold"},zIndex:w,map:r});u<n.length&&n[u].setMap(null);u++;w++;nt.push(it)}if(u<n.length)for(l=u;l<n.length;l++)n[l].setMap(null);n=nt;i===!0&&(rt=new google.maps.LatLngBounds(new google.maps.LatLng(y,b),new google.maps.LatLng(v,p)),r.fitBounds(rt,Math.max($(document).width(),$(document).height())*.02));navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){userLoc=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);s&&s.setMap(null);s=new google.maps.Marker({position:userLoc,icon:g(c()),label:{text:"I am here",color:"#2916BE",fontSize:"16px",fontWeight:"bold"},zindex:ot,map:r})})}}var ft={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},f={},n=[],e=null,a=null,t={},o={},et=new Set,u=[],s=null,h=null,p="",v=[[16,1.8],[15,1.5],[14,1.2]],w=1e4,ot=99999,r=new google.maps.Map(document.getElementById("map"),{zoom:13,panControl:!0,zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,overviewMapControl:!0,rotateControl:!0}),y,l;$("#main-form").submit(function(n){var t=document.getElementById("route").value.trim();if(t===""||t===p)n.preventDefault();else return!0});google.maps.event.addListener(r,"zoom_changed",function(){st(c())});$("#directionOptions").on("change",".directionRadio",function(){b()});$(document.body).bind("mousemove keydown click",k);document.getElementById("route").onfocus=function(){document.getElementById("directionForm").classList.add("fade");document.getElementById("map").classList.add("fade");document.getElementById("btn-traffic").classList.add("fade")};document.getElementById("route").onblur=function(){document.getElementById("directionForm").classList.remove("fade");document.getElementById("map").classList.remove("fade");document.getElementById("btn-traffic").classList.remove("fade")};document.getElementById("btn-traffic").onclick=function(){h===null?(h=new google.maps.TrafficLayer,h.setMap(r),this.classList.remove("btn-outline-success"),this.classList.add("btn-success")):(h.setMap(null),h=null,this.classList.add("btn-outline-success"),this.classList.remove("btn-success"))};y=new URLSearchParams(window.location.search);y.has("route")&&(l=y.get("route"),document.getElementById("route").value=l,p=l,document.title="Bus Location: "+l,document.getElementById("loading").classList.remove("hidden"),ht(),k(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){initialLocation=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);r.setCenter(initialLocation)}),setInterval(function(){t={};o={};et.clear()},864e5))})();